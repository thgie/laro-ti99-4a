30000 SUB LINE ( P1 , P@1 , P2 , P@2 , Z , D ) 
30005 ON ERROR 30085
30010 ON WARNING NEXT 
30015 IF D THEN 30090
30020 A1 = P2 - P1 
30025 A2 = P@2 - P@1 
30030 IF ABS ( A2 ) > ABS ( A1 ) THEN 30050
30035 S2 = ABS ( A2 / A1 ) * SGN ( A2 ) 
30040 S1 = SGN ( A1 ) 
30045 GOTO 30060
30050 S1 = ABS ( A1 / A2 ) * SGN ( A1 ) 
30055 S2 = SGN ( A2 ) 
30060 Y = P@1  :: X = P1 
30065 CALL HCHAR ( X , Y , Z ) 
30070 Y = Y + S2  :: X = X + S1 
30075 IF INT ( Y + .5 ) < > P@2 OR INT ( X + .5 ) < > P2 THEN 30065
30080 GOTO 30235
30085 SUBEXIT 
30090 DIM F ( 8 , 8 )  :: HEX$ = "0123456789ABCDEF" 
30092 FOR P = 1 TO 8  :: FOR Q = 1 TO 8  :: F ( P , Q ) = 0  :: NEXT Q  :: NEXT P 
30095 A1 = P2 - P1 
30100 A2 = P@2 - P@1 
30105 IF ABS ( A2 ) > ABS ( A1 ) THEN 30125
30110 S2 = ABS ( A2 / A1 ) * SGN ( A2 ) 
30115 S1 = SGN ( A1 ) 
30120 GOTO 30135
30125 S1 = ABS ( A1 / A2 ) * SGN ( A1 ) 
30130 S2 = SGN ( A2 ) 
30135 Y = P@1  :: X = P1  :: Y1 , X1 = 4 
30140 F ( X1 , Y1 ) = 1 
30145 Y1 = Y1 + S2  :: X1 = X1 + S1 
30150 IF INT ( X1 + .5 ) > 0 AND INT ( X1 + .5 ) < 9 AND INT ( Y1 + .5 ) > 0 AND INT ( Y1 + .5 ) < 9 THEN 30140
30155 GOTO 30240
30160 FOR STU = 1 TO 8 
30165 W1 = F ( STU , 1 ) * 8 + F ( STU , 2 ) * 4 + F ( STU , 3 ) * 2 + F ( STU , 4 ) + 1 
30170 W2 = F ( STU , 5 ) * 8 + F ( STU , 6 ) * 4 + F ( STU , 7 ) * 2 + F ( STU , 8 ) + 1 
30175 ZE$ = ZE$ & SEG$ ( HEX$ , W1 , 1 ) & SEG$ ( HEX$ , W2 , 1 ) 
30180 NEXT STU 
30185 CALL CHAR ( Z , ZE$ ) 
30190 CALL HCHAR ( X , Y , Z ) 
30195 ZE$ = ""  :: Z = Z + 1 
30200 IF INT ( Y + .5 ) = P@2 AND INT ( X + .5 ) = P2 THEN 30445
30205 IF INT ( X1 + .5 ) > 8 THEN X1 = X1 - 8  :: X = X + 1 
30210 IF INT ( X1 + .5 ) < 1 THEN X1 = X1 + 8  :: X = X - 1 
30215 IF INT ( Y1 + .5 ) > 8 THEN Y1 = Y1 - 8  :: Y = Y + 1 
30220 IF INT ( Y1 + .5 ) < 1 THEN Y1 = Y1 + 8  :: Y = Y - 1 
30225 FOR P = 1 TO 8  :: FOR Q = 1 TO 8  :: F ( P , Q ) = 0  :: NEXT Q  :: NEXT P 
30230 GOTO 30140
30235 GOTO 30445
30240 CALL GCHAR ( X , Y , ZZ ) 
30245 IF ZZ < 32 OR ZZ > 143 THEN 30160
30250 CALL CHARPAT ( ZZ , S$ ) 
30255 IF S$ = RPT$ ( "0" , 16 ) THEN 30160
30260 FOR I = 1 TO 8 
30265 FOR J = 1 TO 2 
30270 PO1 = J * 4 - 3 
30275 POS2 = I * 2 - 1 + J - 1 
30280 ON POS ( HEX$ , SEG$ ( S$ , POS2 , 1 ) , 1 ) GOTO 30435, 30285, 30295, 30305, 30315, 30325, 30335, 30345, 30355, 30365, 30375, 30385, 30395, 30405, 30415, 30425
30285 F ( I , PO1 + 3 ) = 1 
30290 GOTO 30435
30295 F ( I , PO1 + 2 ) = 1 
30300 GOTO 30435
30305 F ( I , PO1 + 2 ) = 1 
30310 GOTO 30285
30315 F ( I , PO1 + 1 ) = 1 
30320 GOTO 30435
30325 F ( I , PO1 + 1 ) = 1 
30330 GOTO 30285
30335 F ( I , PO1 + 1 ) = 1 
30340 GOTO 30295
30345 F ( I , PO1 + 1 ) = 1 
30350 GOTO 30305
30355 F ( I , PO1 ) = 1 
30360 GOTO 30435
30365 F ( I , PO1 ) = 1 
30370 GOTO 30285
30375 F ( I , PO1 ) = 1 
30380 GOTO 30295
30385 F ( I , PO1 ) = 1 
30390 GOTO 30305
30395 F ( I , PO1 ) = 1 
30400 GOTO 30315
30405 F ( I , PO1 ) = 1 
30410 GOTO 30325
30415 F ( I , PO1 ) = 1 
30420 GOTO 30335
30425 F ( I , PO1 ) = 1 
30430 GOTO 30345
30435 NEXT J  :: NEXT I 
30440 GOTO 30160
30445 SUBEND 
30450 END 
